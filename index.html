<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Finance Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .upload-section {
            background: white;
            border-radius: 20px;
            padding: 60px 40px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            margin-bottom: 30px;
        }
        
        .upload-section h1 {
            font-size: 2.5rem;
            color: #2d3748;
            margin-bottom: 10px;
        }
        
        .upload-section p {
            color: #718096;
            font-size: 1.1rem;
            margin-bottom: 30px;
        }
        
        .file-input-wrapper {
            position: relative;
            display: inline-block;
        }
        
        .file-input-wrapper input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-input-label {
            display: inline-block;
            padding: 15px 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .file-input-label:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }
        
        .dashboard {
            display: none;
        }
        
        .dashboard.active {
            display: block;
        }
        
        .header {
            background: white;
            border-radius: 20px;
            padding: 30px 40px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .header h1 {
            color: #2d3748;
            font-size: 2rem;
            margin-bottom: 5px;
        }
        
        .header p {
            color: #718096;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 12px 24px;
            background: #f7fafc;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            color: #4a5568;
        }
        
        .tab:hover {
            background: #edf2f7;
        }
        
        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-label {
            color: #718096;
            font-size: 0.9rem;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 8px;
        }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-sub {
            color: #a0aec0;
            font-size: 0.85rem;
        }
        
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .chart-container h3 {
            color: #2d3748;
            font-size: 1.5rem;
            margin-bottom: 20px;
        }
        
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .transactions-table {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow-x: auto;
        }
        
        .filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .filter-input {
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 0.95rem;
            transition: border-color 0.3s;
        }
        
        .filter-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: #f7fafc;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #4a5568;
            font-size: 0.85rem;
            text-transform: uppercase;
            border-bottom: 2px solid #e2e8f0;
        }
        
        td {
            padding: 15px;
            border-bottom: 1px solid #edf2f7;
            color: #2d3748;
        }
        
        tr:hover {
            background: #f7fafc;
        }
        
        .positive {
            color: #48bb78;
            font-weight: 600;
        }
        
        .negative {
            color: #f56565;
            font-weight: 600;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: white;
            font-size: 1.2rem;
        }
        
        .category-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .category-item {
            margin-bottom: 20px;
        }
        
        .category-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .progress-bar {
            height: 12px;
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }
        
        @media (max-width: 768px) {
            .chart-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .upload-section h1 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Upload Section -->
        <div class="upload-section" id="uploadSection">
            <h1>💰 Personal Finance Dashboard</h1>
            <p>Upload your bank transaction CSV to get started</p>
            <div class="file-input-wrapper">
                <input type="file" id="fileInput" accept=".csv" />
                <label for="fileInput" class="file-input-label">
                    📊 Choose CSV File
                </label>
            </div>
            <div class="loading" id="loadingText" style="display: none;">
                Processing your financial data...
            </div>
        </div>

        <!-- Dashboard -->
        <div class="dashboard" id="dashboard">
            <div class="header">
                <h1>Your Financial Dashboard</h1>
                <p id="dateRange"></p>
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('overview')">Overview</button>
                    <button class="tab" onclick="switchTab('trends')">Trends</button>
                    <button class="tab" onclick="switchTab('transactions')">Transactions</button>
                </div>
            </div>

            <!-- Overview Tab -->
            <div id="overviewTab" class="tab-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Current Balance</div>
                        <div class="stat-value" id="currentBalance" style="color: #4299e1;">$0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Income</div>
                        <div class="stat-value positive" id="totalIncome">$0</div>
                        <div class="stat-sub" id="avgIncome"></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Expenses</div>
                        <div class="stat-value negative" id="totalExpenses">$0</div>
                        <div class="stat-sub" id="avgExpenses"></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Savings Rate</div>
                        <div class="stat-value" id="savingsRate" style="color: #9f7aea;">0%</div>
                        <div class="stat-sub" id="netSavings"></div>
                    </div>
                </div>

                <div class="chart-grid">
                    <div class="chart-container">
                        <h3>Spending by Category</h3>
                        <canvas id="categoryChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Top Spending Categories</h3>
                        <div class="category-list" id="categoryList"></div>
                    </div>
                </div>
            </div>

            <!-- Trends Tab -->
            <div id="trendsTab" class="tab-content" style="display: none;">
                <div class="chart-container">
                    <h3>Monthly Income vs Expenses</h3>
                    <canvas id="monthlyChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>Balance Over Time</h3>
                    <canvas id="balanceChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>Monthly Comparison</h3>
                    <canvas id="barChart"></canvas>
                </div>
            </div>

            <!-- Transactions Tab -->
            <div id="transactionsTab" class="tab-content" style="display: none;">
                <div class="transactions-table">
                    <h3>Transaction History</h3>
                    <div class="filters">
                        <input type="text" class="filter-input" id="searchInput" placeholder="🔍 Search transactions..." />
                        <select class="filter-input" id="typeFilter">
                            <option value="all">All Types</option>
                        </select>
                        <select class="filter-input" id="dateFilter">
                            <option value="all">All Time</option>
                            <option value="30">Last 30 Days</option>
                            <option value="90">Last 90 Days</option>
                            <option value="365">Last Year</option>
                        </select>
                    </div>
                    <table id="transactionsTable">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Description</th>
                                <th>Type</th>
                                <th style="text-align: right;">Amount</th>
                                <th style="text-align: right;">Balance</th>
                            </tr>
                        </thead>
                        <tbody id="transactionsBody"></tbody>
                    </table>
                    <p id="transactionCount" style="margin-top: 15px; color: #718096; text-align: center;"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let allTransactions = [];
        let charts = {};

        document.getElementById('fileInput').addEventListener('change', handleFileUpload);
        document.getElementById('searchInput').addEventListener('input', filterTransactions);
        document.getElementById('typeFilter').addEventListener('change', filterTransactions);
        document.getElementById('dateFilter').addEventListener('change', filterTransactions);

        function handleFileUpload(e) {
            const file = e.target.files[0];
            if (!file) return;

            document.getElementById('loadingText').style.display = 'block';

            Papa.parse(file, {
                header: true,
                dynamicTyping: true,
                skipEmptyLines: true,
                complete: function(results) {
                    allTransactions = results.data.map(row => {
                        const cleaned = {};
                        Object.keys(row).forEach(key => {
                            cleaned[key.trim()] = row[key];
                        });
                        return cleaned;
                    });

                    processData();
                    document.getElementById('uploadSection').style.display = 'none';
                    document.getElementById('dashboard').classList.add('active');
                }
            });
        }

        function processData() {
            const analytics = calculateAnalytics();
            updateStats(analytics);
            createCharts(analytics);
            populateTransactions();
            populateFilters();
        }

        function calculateAnalytics() {
            const totalIncome = allTransactions.filter(t => t.Amount > 0).reduce((sum, t) => sum + t.Amount, 0);
            const totalExpenses = Math.abs(allTransactions.filter(t => t.Amount < 0).reduce((sum, t) => sum + t.Amount, 0));
            const currentBalance = allTransactions[allTransactions.length - 1]?.['Current balance'] || 0;

            // Monthly data
            const monthlyData = {};
            allTransactions.forEach(t => {
                const date = new Date(t.Date);
                const key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                
                if (!monthlyData[key]) {
                    monthlyData[key] = { month: key, income: 0, expenses: 0, balance: 0 };
                }
                
                if (t.Amount > 0) {
                    monthlyData[key].income += t.Amount;
                } else {
                    monthlyData[key].expenses += Math.abs(t.Amount);
                }
                monthlyData[key].balance = t['Current balance'];
            });

            const monthlyTrends = Object.values(monthlyData).sort((a, b) => a.month.localeCompare(b.month));

            // Categories
            const categories = {};
            allTransactions.filter(t => t.Amount < 0).forEach(t => {
                const desc = t.Description.toUpperCase();
                let category = 'Other';
                
                if (desc.includes('HANNAFORD') || desc.includes('SHAWS') || desc.includes('WALMART')) category = 'Groceries';
                else if (desc.includes('RESTAURANT') || desc.includes('PIZZA') || desc.includes('CAFE') || desc.includes('DUNKIN') || desc.includes('BAGEL')) category = 'Food & Dining';
                else if (desc.includes('AMAZON') || desc.includes('BEST BUY') || desc.includes('JCPENNEY')) category = 'Shopping';
                else if (desc.includes('ATT') || desc.includes('INMOTION') || desc.includes('NETFLIX') || desc.includes('SPOTIFY')) category = 'Bills & Utilities';
                else if (desc.includes('U-HAUL')) category = 'Storage';
                else if (desc.includes('VENMO') || desc.includes('CHECK')) category = 'Transfers & Payments';
                else if (desc.includes('GAS') || desc.includes('FUEL') || desc.includes('SHELL') || desc.includes('EXXON')) category = 'Transportation';
                
                if (!categories[category]) categories[category] = 0;
                categories[category] += Math.abs(t.Amount);
            });

            const categoryData = Object.entries(categories)
                .map(([name, value]) => ({ name, value }))
                .sort((a, b) => b.value - a.value);

            return {
                totalIncome,
                totalExpenses,
                currentBalance,
                monthlyTrends,
                categoryData,
                avgMonthlyIncome: totalIncome / monthlyTrends.length,
                avgMonthlyExpenses: totalExpenses / monthlyTrends.length
            };
        }

        function updateStats(analytics) {
            const firstDate = new Date(allTransactions[0].Date).toLocaleDateString();
            const lastDate = new Date(allTransactions[allTransactions.length - 1].Date).toLocaleDateString();
            document.getElementById('dateRange').textContent = `${firstDate} - ${lastDate}`;

            document.getElementById('currentBalance').textContent = `$${analytics.currentBalance.toLocaleString()}`;
            document.getElementById('totalIncome').textContent = `$${analytics.totalIncome.toLocaleString()}`;
            document.getElementById('avgIncome').textContent = `Avg: $${Math.round(analytics.avgMonthlyIncome).toLocaleString()}/mo`;
            document.getElementById('totalExpenses').textContent = `$${analytics.totalExpenses.toLocaleString()}`;
            document.getElementById('avgExpenses').textContent = `Avg: $${Math.round(analytics.avgMonthlyExpenses).toLocaleString()}/mo`;
            
            const savingsRate = ((analytics.totalIncome - analytics.totalExpenses) / analytics.totalIncome * 100).toFixed(1);
            document.getElementById('savingsRate').textContent = `${savingsRate}%`;
            document.getElementById('netSavings').textContent = `Net: $${Math.round(analytics.totalIncome - analytics.totalExpenses).toLocaleString()}`;
        }

        function createCharts(analytics) {
            const colors = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899', '#14b8a6', '#f97316'];

            // Category Pie Chart
            if (charts.categoryChart) charts.categoryChart.destroy();
            charts.categoryChart = new Chart(document.getElementById('categoryChart'), {
                type: 'doughnut',
                data: {
                    labels: analytics.categoryData.map(c => c.name),
                    datasets: [{
                        data: analytics.categoryData.map(c => c.value),
                        backgroundColor: colors
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });

            // Category List
            const categoryList = document.getElementById('categoryList');
            categoryList.innerHTML = analytics.categoryData.map((cat, idx) => {
                const percent = (cat.value / analytics.totalExpenses * 100);
                return `
                    <div class="category-item">
                        <div class="category-header">
                            <span>${cat.name}</span>
                            <span>$${cat.value.toLocaleString()}</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${percent}%; background: ${colors[idx % colors.length]};"></div>
                        </div>
                    </div>
                `;
            }).join('');

            // Monthly Line Chart
            if (charts.monthlyChart) charts.monthlyChart.destroy();
            charts.monthlyChart = new Chart(document.getElementById('monthlyChart'), {
                type: 'line',
                data: {
                    labels: analytics.monthlyTrends.map(m => m.month),
                    datasets: [
                        {
                            label: 'Income',
                            data: analytics.monthlyTrends.map(m => m.income),
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'Expenses',
                            data: analytics.monthlyTrends.map(m => m.expenses),
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top' }
                    }
                }
            });

            // Balance Chart
            if (charts.balanceChart) charts.balanceChart.destroy();
            charts.balanceChart = new Chart(document.getElementById('balanceChart'), {
                type: 'line',
                data: {
                    labels: analytics.monthlyTrends.map(m => m.month),
                    datasets: [{
                        label: 'Balance',
                        data: analytics.monthlyTrends.map(m => m.balance),
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top' }
                    }
                }
            });

            // Bar Chart
            if (charts.barChart) charts.barChart.destroy();
            charts.barChart = new Chart(document.getElementById('barChart'), {
                type: 'bar',
                data: {
                    labels: analytics.monthlyTrends.map(m => m.month),
                    datasets: [
                        {
                            label: 'Income',
                            data: analytics.monthlyTrends.map(m => m.income),
                            backgroundColor: '#10b981'
                        },
                        {
                            label: 'Expenses',
                            data: analytics.monthlyTrends.map(m => m.expenses),
                            backgroundColor: '#ef4444'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top' }
                    }
                }
            });
        }

        function populateFilters() {
            const types = [...new Set(allTransactions.map(t => t.Type))];
            const typeFilter = document.getElementById('typeFilter');
            types.forEach(type => {
                const option = document.createElement('option');
                option.value = type;
                option.textContent = type;
                typeFilter.appendChild(option);
            });
        }

        function populateTransactions() {
            filterTransactions();
        }

        function filterTransactions() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const type = document.getElementById('typeFilter').value;
            const days = parseInt(document.getElementById('dateFilter').value);

            let filtered = [...allTransactions].reverse();

            if (search) {
                filtered = filtered.filter(t => t.Description.toLowerCase().includes(search));
            }

            if (type !== 'all') {
                filtered = filtered.filter(t => t.Type === type);
            }

            if (days !== 'all' && !isNaN(days)) {
                const cutoff = new Date();
                cutoff.setDate(cutoff.getDate() - days);
                filtered = filtered.filter(t => new Date(t.Date) >= cutoff);
            }

            const tbody = document.getElementById('transactionsBody');
            tbody.innerHTML = filtered.slice(0, 100).map(t => `
                <tr>
                    <td>${new Date(t.Date).toLocaleDateString()}</td>
                    <td>${t.Description}</td>
                    <td>${t.Type}</td>
                    <td style="text-align: right;" class="${t.Amount > 0 ? 'positive' : 'negative'}">
                        ${t.Amount > 0 ? '+' : ''}$${Math.abs(t.Amount).toFixed(2)}
                    </td>
                    <td style="text-align: right;">$${t['Current balance'].toFixed(2)}</td>
                </tr>
            `).join('');

            document.getElementById('transactionCount').textContent = 
                filtered.length > 100 ? `Showing 100 of ${filtered.length} transactions` : `${filtered.length} transactions`;
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.style.display = 'none');
            
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').style.display = 'block';
        }
    </script>
</body>
</html>
